<!DOCTYPE html>

<html>

<head>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>

</head>

<body>

    <script>

        var config = {
            type: Phaser.AUTO,
            width: 1200,
            height: 700,
            physics: {
                default: 'arcade',
            },

            scene: {
                preload: preload,
                create: create,
                update: update,
            }

        };

        class Player extends Phaser.Physics.Arcade.Sprite {
            accelerationFactor = 500
            turnAcceleration = 1000
            turnRate = 145
            movementSpeed = 100

            constructor(scene, x, y) {
                super(scene, x, y, 'player');
                scene.add.existing(this);
                scene.physics.add.existing(this);
                this.setCollideWorldBounds(true);

                this.setDamping(true)
                this.setDrag(.25, .25)
                this.setAngularDrag(100)
                this.setBounce(.5, .5)
            }
        }


        var game = new Phaser.Game(config);

        //Keyboard controls
        var cursors;
        var keys;
        var space;

        var gui;
        var guiTimer;

        function preload() {

        }

        function create() {
            player = new Player(this, 400, 400);

            //Set up user input
            cursors = this.input.keyboard.createCursorKeys();
            keys = this.input.keyboard.addKeys('W, A, S, D');
            space = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
            space.on('down', onSpacePress);
        }

        function onSpacePress() {

        }


        function update(time, delta) {
            let deltaSeconds = delta / 1000
            let timeSeconds = time / 1000 

            player.setAcceleration(0,0)
            player.setAngularAcceleration(0)

            let playerMouseDelta = new Phaser.Math.Vector2(game.input.mousePointer.x - player.x , game.input.mousePointer.y - player.y)
            player.setRotation(Math.atan(playerMouseDelta.y / playerMouseDelta.x) )

            let movementVector = new Phaser.Math.Vector2(0,0)

            if (keys.W.isDown) { movementVector.add(1, 0) }
            if (keys.A.isDown) { movementVector.add(-1, 0) }
            if (keys.S.isDown) { movementVector.add(0, -1) }
            if (keys.D.isDown) { movementVector.add(0, 1) }

            movementVector.normalize()

            console.log(movementVector)

            player.setVelocity(player.movementSpeed * movementVector.x, player.movementSpeed * movementVector.y)
            
            // if (keys.A.isDown)

            // //Handle player movements
            // if (cursors.up.isDown) {
            //     player.setAcceleration(player.accelerationFactor * Math.cos(player.angle * Math.PI / 180), player.accelerationFactor * Math.sin(player.angle * Math.PI / 180));
            // }

            // if (cursors.left.isDown || keys.A.isDown) {
            //     player.setAngularVelocity(-player.turnRate)
            //     //player.setAngularAcceleration(-player.turnAcceleration)
            // }

            // if (cursors.right.isDown || keys.D.isDown) {
            //     player.setAngularVelocity(player.turnRate)
            //     //player.setAngularAcceleration(player.turnAcceleration)
            // }
        }

    </script>

</body>

</html>
